âº ğŸ§  Investigation Complete â€” Full Picture                                                                                                        
                                                                                                                                                  
  ---                                                                                                                                             
  Findings Summary                                                                                                                                
                                                                                                                                                  
  1. P1 Milestone Status: COMPLETE âœ…                                                                                                             

  P1 Baseline Evidence Ready
    #6 CLOSED - T03 Metrics & semantic error taxonomy âœ…
    #7 CLOSED - T09A Scenario runner: S1 baseline + artifacts âœ…


  Action needed: Close P1 milestone on GitHub (both issues closed)

  ---
  2. App-A Current State: Baseline Only

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚       Component       â”‚   Status    â”‚                                     What Exists                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ BClient.java          â”‚ âœ… Baseline â”‚ Single gRPC channel, no deadline, no bulkhead, no breaker                            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ErrorCode.java        â”‚ âœ… Complete â”‚ ALL codes defined: SUCCESS, DEADLINE_EXCEEDED, UNAVAILABLE, QUEUE_FULL, CIRCUIT_OPEN â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ MetricsService.java   â”‚ âœ… Complete â”‚ Latency, inflight gauge, error counter. Breaker hardcoded to () -> 0                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Resilience4j          â”‚ âŒ Missing  â”‚ NOT in pom.xml                                                                       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ ResilientBClient.java â”‚ âŒ Missing  â”‚ Not created yet                                                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ values-resilient.yaml â”‚ âŒ Missing  â”‚ Not in chart/                                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Key insight: The foundation is excellent. ErrorCode taxonomy and metrics are fully ready. T04 only needs to ADD the resilient wrapper â€” no
  restructuring required.

  ---
  3. Next Milestone: P2 Resilient P0 (Stop the bleeding)

  P2 Resilient P0
    #8 OPEN - T04 Resilient P0 wrapper  â† CRITICAL PATH BLOCKER
    #9 OPEN - T09B Scenario runner: S1 resilient  â† DEPENDS ON T04


  T04 scope (from issue #8):
  1. Deadline per gRPC call: withDeadlineAfter(deadlineMs)
  2. Bounded inflight bulkhead: maxInflightPerPod semaphore â†’ QUEUE_FULL
  3. Circuit breaker: fail-fast on repeated failures â†’ CIRCUIT_OPEN
  4. Feature flag: RESILIENCE_ENABLED=false (baseline compatibility preserved)

  ---
  4. Minor Issues Found

  T09B issue #9 path mismatch:
  - Issue references: artifacts/S1/resilient/
  - Should be: tmp/artifacts/S1/resilient/ (after our refactor)
  - Needs: Issue comment/update before execution

  ---
  5. Full Milestone Roadmap

  P1 Baseline Evidence Ready      â† DONE (close milestone)
    #6 T03 âœ…  #7 T09A âœ…

  P2 Resilient P0 (Stop bleeding) â† START HERE
    #8 T04: ResilientBClient      â† DO FIRST (critical path)
    #9 T09B: S1 resilient run     â† DEPENDS ON T04

  P3 Resilient P1 (Self-heal)     â† AFTER P2
    #10 T05: keepalive + channel pool
    #11 T10: S4 fault injection (iptables)
    #12 T09C: S4 baseline + resilient artifacts

  P4 Verification + Docs          â† AFTER P3
    #13 T11: verify_s1.sh + verify_s4.sh
    #14 T12: docs packaging + runbook


  ---
  Plan: P2 Execution

  Pre-work (Before T04): 30 mins

  1. Close P1 milestone on GitHub (already earned)
  2. Update issue #9 path: artifacts/ â†’ tmp/artifacts/
  3. Read T04 issue fully before starting implementation

  ---
  T04: ResilientBClient â€” Implementation Plan

  Files to create/modify:

  apps/app-a/
  â”œâ”€â”€ pom.xml                          â† ADD Resilience4j dependency
  â”œâ”€â”€ src/main/java/com/demo/appa/
  â”‚   â”œâ”€â”€ BClient.java                 â† RENAME to BaselineBClient.java
  â”‚   â”œâ”€â”€ ResilientBClient.java        â† NEW: deadline + bulkhead + breaker
  â”‚   â”œâ”€â”€ BClientFactory.java          â† NEW: switch on RESILIENCE_ENABLED
  â”‚   â”œâ”€â”€ MetricsService.java          â† MODIFY: make breaker_state dynamic
  â”‚   â””â”€â”€ WorkController.java          â† MODIFY: inject via factory
  â””â”€â”€ src/main/resources/
      â””â”€â”€ application.yaml             â† ADD: resilience env var bindings

  chart/
  â””â”€â”€ values-resilient.yaml            â† NEW: RESILIENCE_ENABLED=true, DEADLINE_MS=800, MAX_INFLIGHT=10


  ResilientBClient implementation approach:

  // Per call:
  // 1. Check semaphore (inflight cap) â†’ QUEUE_FULL if full
  // 2. Circuit breaker check â†’ CIRCUIT_OPEN if open
  // 3. gRPC call with withDeadlineAfter(deadlineMs) â†’ DEADLINE_EXCEEDED if timeout
  // 4. On success: record, release semaphore
  // 5. On failure: record error, release semaphore, breaker records failure

  New env vars:

  RESILIENCE_ENABLED=false   (default, baseline compat)
  DEADLINE_MS=800            (gRPC call deadline)
  MAX_INFLIGHT=10            (per-pod bulkhead limit)
  BREAKER_FAILURE_RATE=50    (% failures to open breaker)
  BREAKER_WINDOW_SIZE=10     (calls in sliding window)


  Expected P2 outcomes vs baseline:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    Metric     â”‚    S1 Baseline    â”‚       S1 Resilient        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ p99 latency   â”‚ 3700ms            â”‚ â‰¤800ms (deadline)         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Error type    â”‚ timeout           â”‚ QUEUE_FULL / CIRCUIT_OPEN â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Inflight      â”‚ 17-34 (unbounded) â”‚ â‰¤10 (bulkhead)            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Breaker state â”‚ 0 (closed)        â”‚ 1 (open under load)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ---
  T09B: S1 Resilient Run

  - Fix artifact path in issue first
  - Run: ./scripts/run_scenario.sh S1 resilient
  - Compare: tmp/artifacts/S1/baseline/ vs tmp/artifacts/S1/resilient/
  - Expected: clear improvement across all metrics

  ---
  Recommended Sequence

  Step 1 â†’ Close P1 milestone (5 min)
  Step 2 â†’ Update issue #9 path (5 min)
  Step 3 â†’ Developer implements T04 (2-3 hours)
             - Add Resilience4j to pom.xml
             - Create ResilientBClient.java
             - Create BClientFactory.java
             - Update MetricsService.java (dynamic breaker state)
             - Update WorkController.java
             - Create chart/values-resilient.yaml
  Step 4 â†’ Build + test locally (30 min)
             - docker build app-a
             - docker run with RESILIENCE_ENABLED=true
             - curl /api/work â†’ expect QUEUE_FULL or CIRCUIT_OPEN under load
  Step 5 â†’ Architect reviews T04 code (30 min)
  Step 6 â†’ Create PR, merge
  Step 7 â†’ Developer runs T09B (60 min)
             - Deploy to Kind with values-resilient.yaml
             - ./scripts/run_scenario.sh S1 resilient
             - Collect 8 artifacts
             - Compare with baseline
  Step 8 â†’ Architect gates T09B artifacts
  Step 9 â†’ Close P2 milestone
  Step 10 â†’ Plan P3 (T05, T10, T09C)


  ---
  Immediate Next Actions

  1. Close P1 milestone â€” fully earned:

  gh api repos/yschiang/resilience_pattern/milestones \
    --jq '.[] | select(.title=="P1 Baseline Evidence Ready") | .number'
  # Then close it


  2. Start P2 with T04 â€” tell Developer to implement ResilientBClient

  ---
  Shall I:
  - A. Close P1 milestone + update issue #9 path + start T04 now?
  - B. Review T04 issue/plan in more detail first?
  - C. Different priority?